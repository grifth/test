<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <link rel="stylesheet" href="test.css">
</head>

<body>
  <main>
    <div id="main" class="wrapper"></div>
  </main>
</body>
<script>
  //初始化数据
  var hashA = init();
  var keys = hashA.keys;
  var hash = hashA.hash;
  //生成键盘
  createkeyboard(keys,hash);
  //监听用户动作
  listenToKeyborad(hash)
  function createkeyboard(keys,hash){
    for (var i = 0; i < keys.length; i++) {
    var row = keys[i];
    var div = dc('div');
    div.className = 'row';
    main.appendChild(div);
    for (var q = 0; q < row.length; q++) {
      var kbd = dc('kbd');
      var span = createspan(row[q]);
      var img = createimg(hash[row[q]]);
      var button = createbutton(row[q]);
      kbd.className = 'key';
      kbd.appendChild(img);
      kbd.appendChild(button);
      kbd.appendChild(span);
      div.appendChild(kbd);
    }
  }

  }
  function listenToKeyborad(hash){
    document.onkeypress = function (a) {
    var key = a['key'];
    var website = hash[key];
    window.open('http://' + website, '_blank')
  }

  }
  function init() {
    var keys = {
      0: ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
      1: ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
      2: ['z', 'x', 'c', 'v', 'b', 'n', 'm'],
      length: 3
    };
    var hash = { 'q': 'qq.com', 'w': 'weibo.com', 'e': 'ele.me', 'r': 'renren.com', 't': 'tianya.com', 'y': 'youtube.com', 'u': 'uc.com', 'i': 'iqiyi.com', 'o': 'opera.com', 'a': 'acfun.tv', 's': 'sohu.com', 'z': 'zhihu.com', 'm': 'www.mcdonalds.com.cn' };

    var hashInLocalStorage = getFromLocalStorage('zzz');
    if (hashInLocalStorage) {
      hash = hashInLocalStorage
    }
    return{
      "hash":hash,
      "keys":keys,
    }
  }

  function getFromLocalStorage(name) {
    return JSON.parse(localStorage.getItem(name) || 'null');
  }

  function createbutton(id) {
    var button = dc('button');
    button.textContent = '编辑';
    button.id = id;
    button.onclick = function (a) {
      var x = prompt('给我网站');
      var key = a['target']['id'];
      localStorage.setItem('zzz', JSON.stringify(hash));
      hash[key] = x;
    }
    return button;
  }

  function createspan(textContent) {
    var span = dc('span');
    span.textContent = textContent;
    span.className = 'text';
    return span;
  }

  function dc(tagname) {
    return document.createElement(tagname);
  }

  function createimg(domain) {
    var img = dc('img');
    if (domain) {
      img.src = 'http://' + domain + '/favicon.ico';
    }
    else {
      img.src = "//i.loli.net/2017/11/10/5a05afbc5e183.png"
    }
    img.onerror = function (xxx) {
      xxx.target.src = "//i.loli.net/2017/11/10/5a05afbc5e183.png"
    }
    return img;
  }
</script>

</html>